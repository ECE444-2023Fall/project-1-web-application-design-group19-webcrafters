{% extends "bootstrap/base.html" %}

{% block head %}
    {{ super() }}
{% endblock %}

{% block content %}
<script type="text/javascript" charset="utf-8">
    // Universal filtering function
    function updateTag(checkboxObject, selectedTag) {
        const allEvents = {{jsonEvents|safe}};
        allEvents.forEach(event => {
            const tags = event.tags.split(",");
            // Check if event's list of tags includes the selected/deselected tag being filtered
            if (tags.includes(selectedTag)) {
                const currentEventElement = document.getElementById("event" + event.iden);
                // Check if checkbox is checked or unchecked
                if (checkboxObject.checked) {
                    // If checkbox checked, show event
                    currentEventElement.classList.remove("hiddenByTagFilter");
                    currentEventElement.style.display = "flex";

                    // Rerun search to see if event is still valid to be shown
                    runNameSearch(document.getElementById("searchTextInput"));
                } else {
                    // If checkbox not checked, check if event has been hidden by search
                    if (currentEventElement.classList.contains("hiddenByNameSearch")) {
                        // If hidden, change label to be hidden by tag filtering (takes precedence)
                        currentEventElement.classList.remove("hiddenByNameSearch");
                        currentEventElement.classList.add("hiddenByTagFilter");
                    } else {
                        // If not hidden, hide it
                        currentEventElement.classList.add("hiddenByTagFilter");
                        currentEventElement.style.display = "none";
                    }
                }
            }
        });
    }
    
    // Main search function
    function runNameSearch() {
        const input = document.getElementById("searchTextInput").value;
        const allEvents = {{jsonEvents|safe}};
        
        allEvents.forEach(event => {
            const currentEventElement = document.getElementById("event" + event.iden);
            
            // Change event only if not hidden by tag filtering already
            if (!currentEventElement.classList.contains("hiddenByTagFilter")) {
                if (input.length === 0) {
                    // If empty search bar, show all valid events
                    currentEventElement.classList.remove("hiddenByNameSearch");
                    currentEventElement.style.display = "flex";
                } else if (event.name.toLowerCase().includes(input.toLowerCase())) {
                    // If name of event includes the search string, show it
                    currentEventElement.classList.remove("hiddenByNameSearch");
                    currentEventElement.style.display = "flex";
                } else {
                    // If name of event does NOT include search string, hide it
                    currentEventElement.classList.add("hiddenByNameSearch");
                    currentEventElement.style.display = "none";
                }
            }
        });
    }
</script>

<div style="width: 100%; height: auto; position: relative; background: #F5F5F5; min-height: 100%">
    <div style="width:100%; display:flex; flex-wrap:wrap">
        <div style="left: 240px; top: 113px; position:absolute; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 4px; display: inline-flex">
            <div style="color: black; font-size: 24px; font-family: Roboto; font-weight: 400; text-transform: uppercase; letter-spacing: 2.40px; word-wrap: break-word">Search</div>
            <style>
    
                /* Style for the dropdown content */
                .dropdown-content {
                    display: none;
                    position: absolute;
                    background-color: #f1f1f1;
                    min-width: 300px;
                    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                    z-index: 1;
                }
    
                /* Style for the dropdown options */
                .dropdown-content a {
                    padding: 12px 16px;
                    display: block;
                    text-decoration: none;
                    color: #333;
                }
    
                /* Change the background color of dropdown options when hovered */
                .dropdown-content a:hover {
                    background-color: #ddd;
                }
    
                /* Set sizing for search bar */
                .searching input{
                    width: 300px;
                    height: 40px;
                    font-size: 16px;
                }
            </style>
    
            <!-- Text input box -->
            <div id = "search" class = "searching">
                <input type="text" id="searchTextInput" oninput="runNameSearch()" onblur="onBlur()" placeholder="Event Name">
                    
                <!-- Dropdown content -->
                <div id="searchDrop" class="dropdown-content">
                    <!-- Can choose which events to show add links to top searchs here -->
                    <a href="#">Option 1</a>
                    <a href="#">Option 2</a>
                    <a href="#">Option 3</a>
                </div>
            </div>
        
            <!-- Functions for the search bar -->
            <script>
                function searchDropdown() 
                {
                    // Get the text input and the dropdown content elements
                    var input = document.getElementById("searchTextInput");
                    var dropdown = document.getElementById("searchDrop");
            
                    // Show the dropdown if there is text in the input
                    if (input.value.length > 0) {
                        dropdown.style.display = "block";
                    } else{
                        dropdown.style.display = "none";
                    }
                }
            
                function onBlur()
                {
                    // If the search bar loses focus, hide the drop down menu
                    var dropdown = document.getElementById("searchDrop");
                    dropdown.style.display = "none";
                }

                
            </script>
        </div>

        <!-- <div style="left: 700px; top: 113px; position:absolute;">
            <div style="color: black; font-size: 24px; font-family: Roboto; font-weight: 400; text-transform: uppercase; letter-spacing: 2.40px; word-wrap: break-word">Tags</div>
            <select name="Tags" class="form-select" multiple aria-label="Tag selection">
                
                <option value="food">Has Food</option>
                <option value="free">Free</option>
                <option value="career">Career/Professional Development</option>
                <option value="cultural">Cultural</option>
                <option value="social-work">Social Work/Charity</option>
                <option value="fitness">Fitness</option>
                <option value="social">Social</option>
                <option value="dept-trinity">Department - Trinity College</option>
                <option value="dept-fase">Department - FASE</option>
                <option value="dept-uc">Department - University College</option>
              </select>
        </div> -->
    </div>
    
    <!-- Show Events -->
        
    <table style="display: flex; justify-content: center; align-items: center; height: 100%; padding-top: 250px; padding-left: 30px">

        {% for event in events %}
        <td id="{{'event' ~ event.iden}}" style="display: flex; justify-content: center; align-items: center; height: 100%; margin-bottom: 30px">
            <div style="width: 623px; height: 508px; position: relative; background: white; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25); border-radius: 30px; overflow: hidden">
                <div style="width: 623px; height: 98px; left: 0px; top: 0px; position: absolute; background: #061945"></div>
                <div style="width: 356px; height: 39px; left: 15px; top: 27px; position: absolute; color: white; font-size: 28px; font-family: Inter; font-weight: 400; word-wrap: break-word">{{ event.name }}</div>
                <div style="width: 570px; height: 60px; padding: 10px; left: 21px; top: 425px; position: absolute; background: #061945; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.50); border-radius: 10px; justify-content: center; align-items: center; gap: 10px; display: inline-flex">
                  <div style="width: 96px; height: 29px; color: white; font-size: 24px; font-family: Inter; font-weight: 400; word-wrap: break-word">Register</div>
                </div>
                <div style="height: 52px; padding-left: 6px; padding-right: 8px; left: 380px; top: 7px; position: absolute; background: white; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.50); border-radius: 10px; overflow: hidden; justify-content: center; align-items: center; display: inline-flex">
                  <div style="width: 198px; height: 52px; color: #061945; font-size: 16px; font-family: Inter; font-weight: 400; word-wrap: break-word">Hosted by: {{ event.organization }}</div>
                </div>
                <div style="height: 136px; padding-top: 11px; padding-bottom: 10px; padding-left: 9px; padding-right: 27px; left: 21px; top: 236px; position: absolute; background: #25355A; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.50); border-radius: 10px; overflow: hidden; justify-content: flex-start; align-items: center; display: inline-flex">
                  <div style="width: 535px; height: 115px; color: white; font-size: 14px; font-family: Inter; font-weight: 400; word-wrap: break-word">Description: {{ event.description}} </div>
                </div>
                <div style="padding-top: 3px; padding-bottom: 6px; padding-left: 12px; padding-right: 6px; left: 21px; top: 188px; position: absolute; background: #25355A; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.50); border-radius: 10px; overflow: hidden; justify-content: flex-end; align-items: center; display: inline-flex">
                  <div style="width: 553px; height: 24px; color: white; font-size: 14px; font-family: Inter; font-weight: 400; word-wrap: break-word">Tags: {{ event.tags }}</div>
                </div>
                <div style="width: 570px; height: 26px; left: 21px; top: 385px; position: absolute; background: #25355A; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.50)"></div>
                <div style="width: 545px; height: 25px; left: 32px; top: 387px; position: absolute; color: white; font-size: 14px; font-family: Inter; font-weight: 400; word-wrap: break-word">Contact: {{ event.contact }}</div>
                <div style="width: 571px; height: 25px; left: 21px; top: 108px; position: absolute; background: #25355A; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.50); border-radius: 10px"></div>
                <div style="width: 551px; height: 24px; left: 33px; top: 109px; position: absolute; color: white; font-size: 14px; font-family: Inter; font-weight: 400; word-wrap: break-word">Where: {{ event.where }}</div>
                <div style="width: 571px; height: 24px; left: 21px; top: 148px; position: absolute; background: #25355A; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.50); border-radius: 10px"></div>
                <div style="width: 551px; height: 25px; left: 33px; top: 148px; position: absolute; color: white; font-size: 14px; font-family: Inter; font-weight: 400; word-wrap: break-word">When: {{ event.when }}</div>
                <div style="width: 212px; height: 26px; left: 380px; top: 64px; position: absolute; background: white; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.50); border-radius: 10px"></div>
                <div style="width: 184px; height: 23px; left: 392px; top: 67px; position: absolute; text-align: center; color: #061945; font-size: 16px; font-family: Inter; font-weight: 400; word-wrap: break-word">Follow</div>
            </div>
        </td>
        {% endfor %}
    </table>

    <!-- End of Showing Events-->

    <div style="width: 1440px; height: 70px; left: 0px; top: 0px; position: absolute; background: #012A5C"></div>
    <div style="width: 223px; height: 954px; left: 0px; top: 70px; position: absolute; background: #5078A9"></div>
    <div style="width: 1316px; height: 52px; left: 53px; top: 9px; position: absolute">
        <div style="width: 165px; height: 51px; left: 0px; top: 1px; position: absolute; color: white; font-size: 40px; font-family: Sora; font-weight: 600; text-transform: capitalize; word-wrap: break-word">Betula</div>
        
        <!-- Shortcuts to Other Pages -->
        <!-- Style for dashboard text -->
        <style>

            .dashboardShort 
            {
                width: 146px; 
                height: 28px; 
                left: 337px; 
                top: 12px; 
                position: absolute; 
                text-align: center; 
                color: white; 
                font-size: 30px; 
                font-family: Alegreya Sans; 
                font-weight: 500; 
                word-wrap: break-word
            }

            .dashboardShort a 
            {
                color: white;
                text-decoration: none; /* Remove underlines from the link */
            }

        </style>

        <div id="dashShort" class="dashboardShort" onclick="dashboard()">
            <a href="#">Dashboard</a>
        </div>
        
        <!-- Functions for dashboard text -->
        <script>
            // Define the function to be called
            function dashboard() 
            {
                alert("Go to dashboard");
            }
        </script>

        <!-- Style for recommended text -->
        <style>
        .recommendedShort 
        {
            width: 192px; 
            height: 28px; 
            left: 571px; 
            top: 11px; 
            position: absolute; 
            text-align: center; 
            color: white; 
            font-size: 30px; 
            font-family: Alegreya Sans; 
            font-weight: 500; 
            word-wrap: break-word
        }

        .recommendedShort a 
        {
            color: white;
            text-decoration: none; /* Remove underlines from the link */
        }
        </style>

        <div id="recShort" class="recommendedShort" onclick="recommneded()">
            <a href="#">Recommended</a>
        </div>

        <!-- Functions for recommended text -->
        <script>
            // Define the function to be called
            function recommneded() 
            {
                alert("Show recommended");
            }
        </script>

        <!-- Style for events text -->
        <style>
            .myEventsShort 
            {
                width: 155px; 
                height: 28px; 
                left: 851px; 
                top: 10px; 
                position: absolute; 
                text-align: center; 
                color: white; 
                font-size: 30px; 
                font-family: Alegreya Sans; 
                font-weight: 500; 
                word-wrap: break-word
            }
        
            .myEventsShort a 
            {
                color: white;
                text-decoration: none; /* Remove underlines from the link */
            }
        
        </style>
        
        <div id="eventShort" class="myEventsShort" onclick="myEvent()">
            <a href="#">My Events</a>
        </div>

        <!-- Functions for event text -->
        <script>
            // Define the function to be called
            function myEvent()
            {
                alert("Go to my events");
            }
        </script>

        <style>
            .userShort 
            {
                width: 49px; 
                height: 49px; 
                left: 1267px; 
                top: 0px;
                position: absolute;
            }
        
            .userShort a 
            {
                color: white;
                text-decoration: none; /* Remove underlines from the link */
            }
        </style>

        <div id="usrShort" class="userShort">
            <!-- <img href="#" src="/images/user.png" alt="Clickable Image" onclick="myUser()"> -->
            <img src="{{ url_for('static', filename='images/user.png') }}" alt="Clickable Image" onclick="myUser()" style="cursor: pointer;">

        </div>

        <script>
            // Define the function to be called
            function myUser() 
            {
                alert("Go to user page");
            }
        </script>
                
    </div>
    <div style="height: 100%; left: 32px; top: 113px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: flex-end; gap: 30px; display: inline-flex">
    <div style="color: white; font-size: 24px; font-family: Plus Jakarta Sans; font-weight: 500; word-wrap: break-word">Filters</div>

        
        
        <!-- Styling for Events Filter -->
        <style>
            .facultyFilter 
            {
                width: 100px; 
                color: white; 
                font-size: 20px; 
                font-family: Alegreya Sans; 
                font-weight: 400; 
                word-wrap: break-word
            }

            .facultyFilter a 
            {
                color: white;
                text-decoration: none; /* Remove underlines from the link */
            }

            .facultyDropdown-container 
            {
                position: relative;
                display: inline-block;
            }

            /* Style for the text that shows/hides the dropdown */
            .facultyDropdown-text 
            {
                cursor: pointer;
            }

            /* Style for the dropdown menu */
            .facultyDropdown 
            {
                display: none;
                position: absolute;
                background-color: #f1f1f1;
                border: 1px solid #ccc;
                max-height: 200px; /* Set a maximum height for scrollbars */
                width: 150px;
                overflow-y: auto; /* Enable vertical scrolling when needed */
                z-index: 2;
            }

            /* Style for the checkboxes */
            .checkbox-label 
            {
                display: block;
                margin: 4px;
                color:black;
            }

            .down-arrow::after 
            {
                content: " ▼";
                position: absolute;
                right: 0;
            }
        </style>

        <div id="facFilter" class="dropdown facultyFilter" >
            <a href="#" onclick="facultyDropdown(); return false;">Faculty<span class="down-arrow"></span></a>
            <div class="facultyDropdown" id="facultyDrop">
                {% for faculty in facultyTags %}
                <label class="checkbox-label">
                    <input id="{{faculty|lower|replace(' ', '-')}}" type="checkbox" checked onchange="updateTag(this, '{{faculty}}')">{{faculty}}
                </label>
                {% endfor %}
            </div>
        </div>
        
        <!-- Functions for Faculty Filter -->
        <script>
            function facultyDropdown() 
            {
                var dropdown = document.getElementById("facultyDrop");
                dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
                var dropdownTwo = document.getElementById("topicsDrop");
                dropdownTwo.style.display = "none";
                var dropdownThree = document.getElementById("priceDrop");
                dropdownThree.style.display = "none";
            }

            
        </script>

        <!-- Styling for Topics Filter -->
        <style>
            .topcisFilter 
            {
                width: 100px; 
                color: white; 
                font-size: 20px; 
                font-family: Alegreya Sans; 
                font-weight: 400; 
                word-wrap: break-word
            }
        
            .topcisFilter a 
            {
                color: white;
                text-decoration: none; /* Remove underlines from the link */
            }
        
            .topicsDropdown-container 
            {
                    position: relative;
                    display: inline-block;
            }
            
            /* Style for the text that shows/hides the dropdown */
            .topicsDropdown-text 
            {
                cursor: pointer;
            }

            /* Style for the dropdown menu */
            .topicsDropdown 
            {
                display: none;
                position: absolute;
                background-color: #f1f1f1;
                border: 1px solid #ccc;
                max-height: 200px; /* Set a maximum height for scrollbars */
                width: 150px;
                overflow-y: auto; /* Enable vertical scrolling when needed */
                z-index: 3;
            }

            /* Style for the checkboxes */
            .checkbox-label 
            {
                display: block;
                margin: 4px;
                color:black;
            }
        </style>

        <div id="topFilter" class="topcisFilter">
            <a href="#" onclick="topicDropdown(); return false;">Topics<span class="down-arrow"></span></a>
            <div class="topicsDropdown" id="topicsDrop">
                {% for topic in topicTags %}
                <label class="checkbox-label">
                    <input id="{{topic|lower|replace(' ', '-')}}" type="checkbox" checked onchange="updateTag(this, '{{topic}}')">{{topic}}
                </label>
                {% endfor %}
            </div>
        </div>

        <!-- Functions for Topic Filter -->
        <script>
            function topicDropdown() 
            {
                var dropdown = document.getElementById("topicsDrop");
                dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
                var dropdownTwo = document.getElementById("facultyDrop");
                dropdownTwo.style.display = "none";
                var dropdownThree = document.getElementById("priceDrop");
                dropdownThree.style.display = "none";
            }
        </script>

        <!-- Styling for Price Filter -->
        <style>
            .priceFilter 
            {
                width: 100px; 
                color: white; 
                font-size: 20px; 
                font-family: Alegreya Sans; 
                font-weight: 400; 
                word-wrap: break-word
            }
        
            .priceFilter a 
            {
                color: white;
                text-decoration: none; /* Remove underlines from the link */
            }
        
            .priceDropdown-container 
            {
                position: relative;
                display: inline-block;
            }
            
            /* Style for the text that shows/hides the dropdown */
            .priceDropdown-text 
            {
                cursor: pointer;
            }

            /* Style for the dropdown menu */
            .priceDropdown 
            {
                display: none;
                position: absolute;
                background-color: #f1f1f1;
                border: 1px solid #ccc;
                max-height: 200px; /* Set a maximum height for scrollbars */
                width: 150px;
                overflow-y: auto; /* Enable vertical scrolling when needed */
                z-index: 3;
            }

            /* Style for the checkboxes */
            .checkbox-label 
            {
                display: block;
                margin: 4px;
                color:black;
            }
        </style>

        <div id="priFilter dropdown" class="priceFilter">
            <a href="#" onclick="priceDropdown(); return false;">Price<span class="down-arrow"></span></a>
            <div class="priceDropdown" id="priceDrop">
                {% for price in priceTags %}
                <label class="checkbox-label">
                    <input id="{{price|lower|replace(' ', '-')}}" type="checkbox" checked onchange="updateTag(this, '{{price}}')">{{price}}
                </label>
                {% endfor %}
            </div>
        </div>

        <!-- Functions for Price Filter -->
        <script>
            // Define the function to be called
            function priceDropdown() 
            {
                var dropdown = document.getElementById("priceDrop");
                dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
                var dropdownTwo = document.getElementById("facultyDrop");
                dropdownTwo.style.display = "none";
                var dropdownThree = document.getElementById("topicsDrop");
                dropdownThree.style.display = "none";
            }
        </script>
    </div>
</div>


{% endblock %}